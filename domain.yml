# domain.yml
version: "3.1"
session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true

intents:
  - greet
  - goodbye
  - ask_price
  - create_order_dtf
  - inform
  - affirm
  - deny
  - thankyou
  - compliment
  - ask_how_are_you
  - stop_order
  - bot_challenge
  - faq:
      is_retrieval_intent: true
  # Nuevos intents para texto libre
  - inform_email
  - inform_name

entities:
  - sheet_size
  - product_name
  - number
  - email
  - user_name
  - category
  - carrier

slots:
  sheet_size:
    type: text
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: sheet_size
  product_name:
    type: text
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: product_name
  quantity:
    type: float
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: number
  
  # --- Nuevos slots del formulario ---
  category:
    type: text
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: category
      
  # --- ¡AQUÍ ESTÁ LA CORRECCIÓN PARA EL NOMBRE! ---
  # --- ¡ESTA ES LA CORRECCIÓN DEFINITIVA PARA EL NOMBRE! ---
  user_name:
    type: text
    influence_conversation: true
    mappings:
    - type: from_text
      conditions:
      - active_loop: order_form        # <-- Condición 1: SOLO si el formulario está activo
        requested_slot: user_name    # <-- Condición 2: Y SOLO si el bot acaba de pedir el nombre

  user_email:
    type: text
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: email
      intent: inform_email
    - type: from_entity
      entity: email
  carrier:
    type: text
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: carrier

responses:
  # --- Respuestas Básicas y de Chit-Chat ---
  utter_greet:
  - text: "Hey! I'm your DTF assistant. How can I help you with your DTF and UV DTF orders today?"
  utter_goodbye:
  - text: "Goodbye! Have a great day."
  utter_iamabot:
  - text: "I am a bot, powered by Rasa."
  utter_you_are_welcome:
  - text: "You're welcome! Is there anything else I can help you with?"
  utter_good_bot:
  - text: "Thanks! I'm happy to help."
  utter_how_are_you:
  - text: "I'm a bot, so I'm always running at 100%! How can I help you?"
  utter_order_cancelled:
  - text: "OK, I've cancelled this order. What can I help you with next?"
  utter_default:
  - text: "Sorry, I'm not sure how to respond to that. Can you try rephrasing?"

  # --- Respuestas del Formulario (con doble llave) ---
  utter_ask_product_name:
  - custom:
      type: "buttons"
      text: "What product would you like to order?"
      options:
      - title: "DTF Gang Sheet"
        payload: '/inform{{"product_name":"DTF Custom Gang Sheet"}}'
      - title: "UV DTF Gang Sheet"
        payload: '/inform{{"product_name":"UV DTF Gang Sheet"}}'
      - title: "6 Pack T-Shirts"
        payload: '/inform{{"product_name":"6 Pack T-Shirts"}}'
      - title: "DTF + Heat Press"
        payload: '/inform{{"product_name":"DTF + Heat Press"}}'
  
  utter_ask_sheet_size:
  - custom:
      type: "buttons"
      text: "What size gang sheet do you need?"
      options:
      - title: "22x12"
        payload: '/inform{{"sheet_size":"22x12"}}'
      - title: "22x36"
        payload: '/inform{{"sheet_size":"22x36"}}'
      - title: "22x60"
        payload: '/inform{{"sheet_size":"22x60"}}'
      - title: "11x12 (UV)"
        payload: '/inform{{"sheet_size":"11x12"}}'
      - title: "11x24 (UV)"
        payload: '/inform{{"sheet_size":"11x24"}}'
  
  utter_ask_quantity:
  - text: "How many would you like?"
  
  utter_ask_category:
  - custom:
      type: "buttons"
      text: "Please select a category for your product."
      options:
      - title: "Heat Press"
        payload: '/inform{{"category":"Heat Press"}}'
      - title: "DTF Fluorescent Gang Sheets"
        payload: '/inform{{"category":"DTF Fluorescent Gang Sheets"}}'
      - title: "UV DTF Gang Sheet"
        payload: '/inform{{"category":"UV DTF Gang Sheet"}}'
      - title: "DTF Gang Sheet"
        payload: '/inform{{"category":"DTF Gang Sheet"}}'
      - title: "Print by size"
        payload: '/inform{{"category":"Print by size"}}'
      - title: "Custom Size UV DTF Gang Sheet"
        payload: '/inform{{"category":"Custom Size UV DTF Gang Sheet"}}'
      - title: "Custom Size DTF Gang Sheet"
        payload: '/inform{{"category":"Custom Size DTF Gang Sheet"}}'

  utter_ask_user_name:
  - text: "What's your full name?"

  utter_ask_user_email:
  - text: "What's your email address? We'll send the confirmation here."

  utter_ask_carrier:
  - custom:
      type: "buttons"
      text: "How would you like to receive your order?"
      options:
      - title: "Store Pickup (San Dimas)"
        payload: '/inform{{"carrier":"Store Pickup (San Dimas)"}}'
      - title: "Store Pickup (Covina)"
        payload: '/inform{{"carrier":"Store Pickup (Covina)"}}'
      - title: "UPS Ground"
        payload: '/inform{{"carrier":"UPS Ground"}}'
      - title: "UPS 2nd Day"
        payload: '/inform{{"carrier":"UPS 2nd Day"}}'
      - title: "UPS Next Day"
        payload: '/inform{{"carrier":"UPS Next Day"}}'
      - title: "USPS"
        payload: '/inform{{"carrier":"USPS"}}'

  # --- Todas tus respuestas de FAQ (faq/...) ---
  utter_faq/what_is_dtf:
  - text: "DTF (Direct-to-Film) transfers are printed onto a special film... (etc)"
  utter_faq/what_is_uv_dtf:
  - text: "UV DTF is for hard surfaces... (etc) \n\n**What is UV Transfers?**\n[Watch the video](https://youtu.be/XxZ6-aYz-V4)"
  # ... (Pega el resto de tus respuestas de FAQ aquí) ...


actions:
  - action_get_price
  - validate_order_form
  - action_submit_order_to_api
  - action_cancel_order

forms:
  order_form:
    required_slots: [] # Manejado dinámicamente en actions.py