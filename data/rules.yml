version: "3.1"

rules:

- rule: Respond to bot_challenge
  steps:
  - intent: bot_challenge
  - action: utter_iamabot

# --- REGLAS DE CHIT-CHAT (Sin cambios) ---
- rule: Respond to thankyou
  steps:
  - intent: thankyou
  - action: utter_you_are_welcome

- rule: Respond to compliment
  steps:
  - intent: compliment
  - action: utter_good_bot

- rule: Respond to ask_how_are_you
  steps:
  - intent: ask_how_are_you
  - action: utter_how_are_you

# --- REGLAS DEL FORMULARIO DE PEDIDO (AHORA COMENTADAS) ---
# - rule: Activate Order Form
#   steps:
#   - intent: create_order_dtf
#   - action: order_form
#   - active_loop: order_form
#
# - rule: Submit Order Form
#   condition:
#   - active_loop: order_form
#   steps:
#   - action: order_form
#   - active_loop: null
#   - slot_was_set:
#     - requested_slot: null
#   - action: action_submit_order_to_api
#
# - rule: Cancel order form with 'stop_order' or 'deny'
#   condition:
#   - active_loop: order_form
#   steps:
#   - or:
#     - intent: stop_order
#     - intent: deny
#   - action: action_cancel_order
#   - active_loop: null

# --- ¡CLAVE! REGLAS DE Q&A INTELIGENTES ---
# Esta regla reemplaza TUS 20 REGLAS de Q&A
- rule: Respond to any FAQ
  steps:
  - intent: faq # Esto captura CUALQUIER intent "faq/..."
  - action: utter_faq # Esto responde con la respuesta "utter_faq/..." correcta

# Esta regla reemplaza TUS 20 REGLAS de interrupción
#- rule: Handle any FAQ during form
#  condition:
#  - active_loop: order_form
#  steps:
#  - intent: faq # Captura CUALQUIER pregunta
#  - action: utter_faq # Responde la pregunta
#  - action: order_form # Vuelve al formulario
#  - active_loop: order_form

# (Nota: Mantenemos tu regla de 'ask_price' por si acaso)
#- rule: Handle ask_price during form
#  condition:
#  - active_loop: order_form
#  steps:
#  - intent: ask_price
#  - action: action_get_price
#  - action: order_form
#  - active_loop: order_form

- rule: Handle ask_price OUTSIDE form
  condition:
  - active_loop: null  # <-- Le dice a Rasa que esto es solo cuando NINGÚN formulario está activo
  steps:
  - intent: ask_price
  - action: action_get_price


- rule: Handle ambiguity (ask for rephrasing)
  # Esta regla se activa si el FallbackClassifier está inseguro
  # (por debajo de 'threshold' pero por encima de 'ambiguity_threshold')
  steps:
  - intent: nlu_fallback
  - action: utter_ask_rephrase
  - action: action_listen

